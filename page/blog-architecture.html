<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquitectura del Juego - Donkey Kong Classic</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="blogstyle.css">
</head>
<body>
    <script src="lang.js"></script>
    <div class="nav-header">
        <a href="blog.html" class="back-button">
            <span data-lang="es">← Volver al Blog</span>
            <span data-lang="en" style="display:none">← Back to Blog</span>
        </a>
        <button class="lang-btn" onclick="toggleLanguage()">
            <span data-lang="es">🇺🇸 EN</span>
            <span data-lang="en" style="display:none">🇪🇸 ES</span>
        </button>
    </div>
    
    <div class="article-container">
        <div class="article-header">
            <h1>
                <span data-lang="es">🏗️ Arquitectura del Juego</span>
                <span data-lang="en" style="display:none">🏗️ Game Architecture</span>
            </h1>
            <p>
                <span data-lang="es">Diseño modular y patrones de arquitectura para un código mantenible</span>
                <span data-lang="en" style="display:none">Modular design and architecture patterns for maintainable code</span>
            </p>
        </div>

        <div class="article-content">
            <h2>
                <span data-lang="es">Visión General de la Arquitectura</span>
                <span data-lang="en" style="display:none">Architecture Overview</span>
            </h2>
            <p>
                <span data-lang="es">El juego sigue una arquitectura modular basada en managers que separa las responsabilidades y promueve la mantenibilidad. El sistema está construido alrededor del concepto de managers especializados que manejan diferentes aspectos del juego.</span>
                <span data-lang="en" style="display:none">The game follows a modular manager-based architecture that separates responsibilities and promotes maintainability. The system is built around the concept of specialized managers that handle different aspects of the game.</span>
            </p>

            <div class="architecture-diagram">
                <pre>┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Game Manager  │────│  State Manager  │────│ Tutorial Manager│
│   (Coordinador) │    │   (Flujo Juego) │    │   (Aprendizaje) │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ Entity Manager  │    │Collision Manager│    │   UI Manager    │
│   (Entidades)   │    │    (Física)     │    │  (Interfaz)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  Level Manager  │    │ Firebase Manager│    │  Sound Manager  │
│    (Niveles)    │    │  (Datos Nube)   │    │     (Audio)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘</pre>
            </div>

            <h2>
                <span data-lang="es">Componentes Principales</span>
                <span data-lang="en" style="display:none">Main Components</span>
            </h2>

            <h3>
                <span data-lang="es">1. Game Manager (src/game/game_manager.py)</span>
                <span data-lang="en" style="display:none">1. Game Manager (src/game/game_manager.py)</span>
            </h3>
            <p>
                <span data-lang="es"><span class="highlight">Propósito:</span> Coordinador central que orquesta todos los sistemas del juego.</span>
                <span data-lang="en" style="display:none"><span class="highlight">Purpose:</span> Central coordinator that orchestrates all game systems.</span>
            </p>
            
            <p>
                <span data-lang="es"><span class="highlight">Responsabilidades:</span></span>
                <span data-lang="en" style="display:none"><span class="highlight">Responsibilities:</span></span>
            </p>
            <ul>
                <li>
                    <span data-lang="es">Ejecución del bucle principal del juego</span>
                    <span data-lang="en" style="display:none">Main game loop execution</span>
                </li>
                <li>
                    <span data-lang="es">Coordinación de managers</span>
                    <span data-lang="en" style="display:none">Manager coordination</span>
                </li>
                <li>
                    <span data-lang="es">Delegación del manejo de eventos</span>
                    <span data-lang="en" style="display:none">Event handling delegation</span>
                </li>
                <li>
                    <span data-lang="es">Coordinación del renderizado</span>
                    <span data-lang="en" style="display:none">Rendering coordination</span>
                </li>
            </ul>

            <div class="code-block">
                <pre>def run(self):
    <span data-lang="es">"""Bucle principal del juego"""</span><span data-lang="en" style="display:none">"""Main game loop"""</span>
    while self.running:
        self.handle_events()
        self.update()
        self.render()
        self.clock.tick(self.config.FPS)

def handle_events(self):
    <span data-lang="es">"""Delega eventos a los managers apropiados"""</span><span data-lang="en" style="display:none">"""Delegates events to appropriate managers"""</span>
    
def update(self):
    <span data-lang="es">"""Actualiza todos los sistemas del juego"""</span><span data-lang="en" style="display:none">"""Updates all game systems"""</span>
    
def render(self):
    <span data-lang="es">"""Renderiza todos los elementos visuales"""</span><span data-lang="en" style="display:none">"""Renders all visual elements"""</span></pre>
            </div>

            <h3>
                <span data-lang="es">2. Entity Manager (src/managers/entity_manager.py)</span>
                <span data-lang="en" style="display:none">2. Entity Manager (src/managers/entity_manager.py)</span>
            </h3>
            <p>
                <span data-lang="es"><span class="highlight">Propósito:</span> Gestiona todas las entidades del juego (jugador, enemigos, coleccionables, proyectiles).</span>
                <span data-lang="en" style="display:none"><span class="highlight">Purpose:</span> Manages all game entities (player, enemies, collectibles, projectiles).</span>
            </p>
            
            <p>
                <span data-lang="es"><span class="highlight">Responsabilidades:</span></span>
                <span data-lang="en" style="display:none"><span class="highlight">Responsibilities:</span></span>
            </p>
            <ul>
                <li>
                    <span data-lang="es">Gestión del ciclo de vida de entidades</span>
                    <span data-lang="en" style="display:none">Entity lifecycle management</span>
                </li>
                <li>
                    <span data-lang="es">Control de spawn y timing</span>
                    <span data-lang="en" style="display:none">Spawn control and timing</span>
                </li>
                <li>
                    <span data-lang="es">Actualizaciones e interacciones de entidades</span>
                    <span data-lang="en" style="display:none">Entity updates and interactions</span>
                </li>
                <li>
                    <span data-lang="es">Coordinación del renderizado</span>
                    <span data-lang="en" style="display:none">Rendering coordination</span>
                </li>
            </ul>

            <div class="code-block">
                <pre>class EntityManager:
    def __init__(self, config):
        self.player = None
        self.enemies = []
        self.collectibles = []
        self.projectiles = []
        
        <span data-lang="es"># Control de spawn</span><span data-lang="en" style="display:none"># Spawn control</span>
        self.spawn_timer = 0
        self.monster_spawn_timer = 0
        self.monsters_spawned = 0</pre>
            </div>

            <h3>
                <span data-lang="es">3. Game State Manager (src/managers/game_state_manager.py)</span>
                <span data-lang="en" style="display:none">3. Game State Manager (src/managers/game_state_manager.py)</span>
            </h3>
            <p>
                <span data-lang="es"><span class="highlight">Propósito:</span> Gestiona los estados del juego y las transiciones.</span>
                <span data-lang="en" style="display:none"><span class="highlight">Purpose:</span> Manages game states and transitions.</span>
            </p>
            
            <p>
                <span data-lang="es"><span class="highlight">Estados:</span></span>
                <span data-lang="en" style="display:none"><span class="highlight">States:</span></span>
            </p>
            <ul>
                <li>
                    <span data-lang="es"><code>MENU</code> - Menú principal</span>
                    <span data-lang="en" style="display:none"><code>MENU</code> - Main menu</span>
                </li>
                <li>
                    <span data-lang="es"><code>TUTORIAL</code> - Modo tutorial</span>
                    <span data-lang="en" style="display:none"><code>TUTORIAL</code> - Tutorial mode</span>
                </li>
                <li>
                    <span data-lang="es"><code>PLAYING</code> - Gameplay activo</span>
                    <span data-lang="en" style="display:none"><code>PLAYING</code> - Active gameplay</span>
                </li>
                <li>
                    <span data-lang="es"><code>PAUSED</code> - Juego pausado</span>
                    <span data-lang="en" style="display:none"><code>PAUSED</code> - Game paused</span>
                </li>
                <li>
                    <span data-lang="es"><code>SHOP</code> - Tienda del juego</span>
                    <span data-lang="en" style="display:none"><code>SHOP</code> - Game shop</span>
                </li>
                <li>
                    <span data-lang="es"><code>GAME_OVER</code> - Pantalla de game over</span>
                    <span data-lang="en" style="display:none"><code>GAME_OVER</code> - Game over screen</span>
                </li>
                <li>
                    <span data-lang="es"><code>LEVEL_COMPLETE</code> - Completar nivel</span>
                    <span data-lang="en" style="display:none"><code>LEVEL_COMPLETE</code> - Level complete</span>
                </li>
            </ul>

            <div class="code-block">
                <pre>def set_state(self, new_state):
    <span data-lang="es">"""Transición segura de estado con validación"""</span><span data-lang="en" style="display:none">"""Safe state transition with validation"""</span>
    
def is_playing(self):
    <span data-lang="es">"""Verifica si está en estados de gameplay activo"""</span><span data-lang="en" style="display:none">"""Checks if in active gameplay states"""</span>
    return self.state in ["PLAYING", "TUTORIAL"]</pre>
            </div>

            <h2>
                <span data-lang="es">Sistema de Entidades</span>
                <span data-lang="en" style="display:none">Entity System</span>
            </h2>

            <h3>
                <span data-lang="es">Jerarquía de Entidades</span>
                <span data-lang="en" style="display:none">Entity Hierarchy</span>
            </h3>
            <div class="architecture-diagram">
                <pre><span data-lang="es">Entity (Base)
├── Player
│   ├── Sistema de Movimiento
│   ├── Sistema de Animación
│   └── Sistema de Inventario
├── Enemy
│   ├── Barrel (Dirigido por IA)
│   └── Monster (Máquina de estados)
├── Collectible
│   └── Star (Valores de puntos: 10, 20, 50)
└── Projectile
    └── Banana (Explosivo)</span><span data-lang="en" style="display:none">Entity (Base)
├── Player
│   ├── Movement System
│   ├── Animation System
│   └── Inventory System
├── Enemy
│   ├── Barrel (AI-driven)
│   └── Monster (State machine)
├── Collectible
│   └── Star (Point values: 10, 20, 50)
└── Projectile
    └── Banana (Explosive)</span></pre>
            </div>

            <h3>
                <span data-lang="es">Sistema del Jugador (src/entities/player.py)</span>
                <span data-lang="en" style="display:none">Player System (src/entities/player.py)</span>
            </h3>
            <p>
                <span data-lang="es"><span class="highlight">Características:</span></span>
                <span data-lang="en" style="display:none"><span class="highlight">Features:</span></span>
            </p>
            <ul>
                <li>
                    <span data-lang="es">Animación basada en sprites (12 frames para secuencia de salto)</span>
                    <span data-lang="en" style="display:none">Sprite-based animation (12 frames for jump sequence)</span>
                </li>
                <li>
                    <span data-lang="es">Movimiento basado en física</span>
                    <span data-lang="en" style="display:none">Physics-based movement</span>
                </li>
                <li>
                    <span data-lang="es">Gestión de inventario (bananas, vidas, puntuación)</span>
                    <span data-lang="en" style="display:none">Inventory management (bananas, lives, score)</span>
                </li>
                <li>
                    <span data-lang="es">Manejo de entrada</span>
                    <span data-lang="en" style="display:none">Input handling</span>
                </li>
            </ul>

            <div class="code-block">
                <pre>def update_animation(self):
    <span data-lang="es">"""Maneja la animación de sprites basada en el estado"""</span><span data-lang="en" style="display:none">"""Handles sprite animation based on state"""</span>
    if not self.on_ground and self.sprites['jump']:
        <span data-lang="es"># Reproduce secuencia de animación de salto</span><span data-lang="en" style="display:none"># Play jump animation sequence</span>
        if not self.is_jumping_animation:
            self.is_jumping_animation = True
            self.jump_frame = 0</pre>
            </div>

            <h2>
                <span data-lang="es">Arquitectura de IA</span>
                <span data-lang="en" style="display:none">AI Architecture</span>
            </h2>

            <h3>
                <span data-lang="es">Sistema de IA Híbrido</span>
                <span data-lang="en" style="display:none">Hybrid AI System</span>
            </h3>
            <p>
                <span data-lang="es">El juego implementa un sofisticado sistema de IA que combina múltiples enfoques:</span>
                <span data-lang="en" style="display:none">The game implements a sophisticated AI system that combines multiple approaches:</span>
            </p>

            <ol>
                <li>
                    <span data-lang="es"><strong>Capa de Decisión Primaria:</strong> Lógica basada en reglas para comportamiento confiable</span>
                    <span data-lang="en" style="display:none"><strong>Primary Decision Layer:</strong> Rule-based logic for reliable behavior</span>
                </li>
                <li>
                    <span data-lang="es"><strong>Capa de Validación:</strong> Q-Learning para refinamiento de comportamiento</span>
                    <span data-lang="en" style="display:none"><strong>Validation Layer:</strong> Q-Learning for behavior refinement</span>
                </li>
                <li>
                    <span data-lang="es"><strong>Capa de Seguridad:</strong> Mecanismos anti-atasco y de respaldo</span>
                    <span data-lang="en" style="display:none"><strong>Safety Layer:</strong> Anti-stuck and fallback mechanisms</span>
                </li>
            </ol>

            <div class="code-block">
                <pre>def barrel_movement(self, platforms, player_rect=None):
    <span data-lang="es"># 1. Decisión primaria basada en reglas</span><span data-lang="en" style="display:none"># 1. Primary rule-based decision</span>
    primary_action = self.decide_primary_action(dx, dy, current_platform, player_platform)
    
    <span data-lang="es"># 2. Validación Q-Learning</span><span data-lang="en" style="display:none"># 2. Q-Learning validation</span>
    if hasattr(self, 'ai_agent'):
        q_action = self.ai_agent.choose_action(state)
        if self.should_override_action(primary_action, q_action, dx, dy):
            primary_action = q_action
    
    <span data-lang="es"># 3. Ejecutar decisión</span><span data-lang="en" style="display:none"># 3. Execute decision</span>
    self.execute_action_decision(primary_action, current_platform, dx)</pre>
            </div>

            <h2>
                <span data-lang="es">Gestión de Datos</span>
                <span data-lang="en" style="display:none">Data Management</span>
            </h2>

            <h3>
                <span data-lang="es">Integración con Firebase (src/managers/firebase_manager.py)</span>
                <span data-lang="en" style="display:none">Firebase Integration (src/managers/firebase_manager.py)</span>
            </h3>
            <p>
                <span data-lang="es"><span class="highlight">Servicios Utilizados:</span></span>
                <span data-lang="en" style="display:none"><span class="highlight">Services Used:</span></span>
            </p>
            <ul>
                <li>
                    <span data-lang="es"><strong>Realtime Database:</strong> Leaderboards y guardados en la nube</span>
                    <span data-lang="en" style="display:none"><strong>Realtime Database:</strong> Leaderboards and cloud saves</span>
                </li>
                <li>
                    <span data-lang="es"><strong>Authentication:</strong> Gestión de usuarios</span>
                    <span data-lang="en" style="display:none"><strong>Authentication:</strong> User management</span>
                </li>
                <li>
                    <span data-lang="es"><strong>REST API:</strong> Comunicación HTTP directa (sin SDK)</span>
                    <span data-lang="en" style="display:none"><strong>REST API:</strong> Direct HTTP communication (no SDK)</span>
                </li>
            </ul>

            <h2>
                <span data-lang="es">Conclusión</span>
                <span data-lang="en" style="display:none">Conclusion</span>
            </h2>
            <p>
                <span data-lang="es">Esta arquitectura proporciona una base sólida para un juego mantenible, extensible y de alto rendimiento, manteniendo una separación limpia de responsabilidades y un manejo robusto de errores. El patrón de managers permite una fácil extensión y modificación de funcionalidades sin afectar otros sistemas.</span>
                <span data-lang="en" style="display:none">This architecture provides a solid foundation for a maintainable, extensible, and high-performance game, maintaining clean separation of concerns and robust error handling. The manager pattern allows for easy extension and modification of functionality without affecting other systems.</span>
            </p>
        </div>
    </div>
</body>
</html>