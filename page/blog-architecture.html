<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquitectura del Juego - Donkey Kong Classic</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .article-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .article-header {
            text-align: center;
            margin-bottom: 40px;
        }
        .article-header h1 {
            color: #FFD700;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .article-content {
            color: #fff;
            line-height: 1.8;
        }
        .article-content h2 {
            color: #4ECDC4;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        .article-content h3 {
            color: #FF6B6B;
            margin-top: 25px;
            margin-bottom: 10px;
        }
        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #4ECDC4;
            overflow-x: auto;
        }
        .code-block pre {
            margin: 0;
            color: #fff;
            font-family: 'Courier New', monospace;
        }
        .architecture-diagram {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #4ECDC4;
            font-family: monospace;
            color: #4ECDC4;
            text-align: center;
        }
        .highlight {
            background: rgba(255, 215, 0, 0.2);
            padding: 2px 5px;
            border-radius: 3px;
        }
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <a href="blog.html" class="back-button">â† Volver al Blog</a>
    
    <div class="article-container">
        <div class="article-header">
            <h1>ğŸ—ï¸ Arquitectura del Juego</h1>
            <p>DiseÃ±o modular y patrones de arquitectura para un cÃ³digo mantenible</p>
        </div>

        <div class="article-content">
            <h2>VisiÃ³n General de la Arquitectura</h2>
            <p>El juego sigue una arquitectura modular basada en managers que separa las responsabilidades y promueve la mantenibilidad. El sistema estÃ¡ construido alrededor del concepto de managers especializados que manejan diferentes aspectos del juego.</p>

            <div class="architecture-diagram">
                <pre>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Game Manager  â”‚â”€â”€â”€â”€â”‚  State Manager  â”‚â”€â”€â”€â”€â”‚ Tutorial Managerâ”‚
â”‚   (Coordinador) â”‚    â”‚   (Flujo Juego) â”‚    â”‚   (Aprendizaje) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Entity Manager  â”‚    â”‚Collision Managerâ”‚    â”‚   UI Manager    â”‚
â”‚   (Entidades)   â”‚    â”‚    (FÃ­sica)     â”‚    â”‚  (Interfaz)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level Manager  â”‚    â”‚ Firebase Managerâ”‚    â”‚  Sound Manager  â”‚
â”‚    (Niveles)    â”‚    â”‚  (Datos Nube)   â”‚    â”‚     (Audio)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
            </div>

            <h2>Componentes Principales</h2>

            <h3>1. Game Manager (src/game/game_manager.py)</h3>
            <p><span class="highlight">PropÃ³sito:</span> Coordinador central que orquesta todos los sistemas del juego.</p>
            
            <p><span class="highlight">Responsabilidades:</span></p>
            <ul>
                <li>EjecuciÃ³n del bucle principal del juego</li>
                <li>CoordinaciÃ³n de managers</li>
                <li>DelegaciÃ³n del manejo de eventos</li>
                <li>CoordinaciÃ³n del renderizado</li>
            </ul>

            <div class="code-block">
                <pre>def run(self):
    """Bucle principal del juego"""
    while self.running:
        self.handle_events()
        self.update()
        self.render()
        self.clock.tick(self.config.FPS)

def handle_events(self):
    """Delega eventos a los managers apropiados"""
    
def update(self):
    """Actualiza todos los sistemas del juego"""
    
def render(self):
    """Renderiza todos los elementos visuales"""</pre>
            </div>

            <h3>2. Entity Manager (src/managers/entity_manager.py)</h3>
            <p><span class="highlight">PropÃ³sito:</span> Gestiona todas las entidades del juego (jugador, enemigos, coleccionables, proyectiles).</p>
            
            <p><span class="highlight">Responsabilidades:</span></p>
            <ul>
                <li>GestiÃ³n del ciclo de vida de entidades</li>
                <li>Control de spawn y timing</li>
                <li>Actualizaciones e interacciones de entidades</li>
                <li>CoordinaciÃ³n del renderizado</li>
            </ul>

            <div class="code-block">
                <pre>class EntityManager:
    def __init__(self, config):
        self.player = None
        self.enemies = []
        self.collectibles = []
        self.projectiles = []
        
        # Control de spawn
        self.spawn_timer = 0
        self.monster_spawn_timer = 0
        self.monsters_spawned = 0</pre>
            </div>

            <h3>3. Game State Manager (src/managers/game_state_manager.py)</h3>
            <p><span class="highlight">PropÃ³sito:</span> Gestiona los estados del juego y las transiciones.</p>
            
            <p><span class="highlight">Estados:</span></p>
            <ul>
                <li><code>MENU</code> - MenÃº principal</li>
                <li><code>TUTORIAL</code> - Modo tutorial</li>
                <li><code>PLAYING</code> - Gameplay activo</li>
                <li><code>PAUSED</code> - Juego pausado</li>
                <li><code>SHOP</code> - Tienda del juego</li>
                <li><code>GAME_OVER</code> - Pantalla de game over</li>
                <li><code>LEVEL_COMPLETE</code> - Completar nivel</li>
            </ul>

            <div class="code-block">
                <pre>def set_state(self, new_state):
    """TransiciÃ³n segura de estado con validaciÃ³n"""
    
def is_playing(self):
    """Verifica si estÃ¡ en estados de gameplay activo"""
    return self.state in ["PLAYING", "TUTORIAL"]</pre>
            </div>

            <h2>Sistema de Entidades</h2>

            <h3>JerarquÃ­a de Entidades</h3>
            <div class="architecture-diagram">
                <pre>Entity (Base)
â”œâ”€â”€ Player
â”‚   â”œâ”€â”€ Sistema de Movimiento
â”‚   â”œâ”€â”€ Sistema de AnimaciÃ³n
â”‚   â””â”€â”€ Sistema de Inventario
â”œâ”€â”€ Enemy
â”‚   â”œâ”€â”€ Barrel (Dirigido por IA)
â”‚   â””â”€â”€ Monster (MÃ¡quina de estados)
â”œâ”€â”€ Collectible
â”‚   â””â”€â”€ Star (Valores de puntos: 10, 20, 50)
â””â”€â”€ Projectile
    â””â”€â”€ Banana (Explosivo)</pre>
            </div>

            <h3>Sistema del Jugador (src/entities/player.py)</h3>
            <p><span class="highlight">CaracterÃ­sticas:</span></p>
            <ul>
                <li>AnimaciÃ³n basada en sprites (12 frames para secuencia de salto)</li>
                <li>Movimiento basado en fÃ­sica</li>
                <li>GestiÃ³n de inventario (bananas, vidas, puntuaciÃ³n)</li>
                <li>Manejo de entrada</li>
            </ul>

            <div class="code-block">
                <pre>def update_animation(self):
    """Maneja la animaciÃ³n de sprites basada en el estado"""
    if not self.on_ground and self.sprites['jump']:
        # Reproduce secuencia de animaciÃ³n de salto
        if not self.is_jumping_animation:
            self.is_jumping_animation = True
            self.jump_frame = 0</pre>
            </div>

            <h2>Arquitectura de IA</h2>

            <h3>Sistema de IA HÃ­brido</h3>
            <p>El juego implementa un sofisticado sistema de IA que combina mÃºltiples enfoques:</p>

            <ol>
                <li><strong>Capa de DecisiÃ³n Primaria:</strong> LÃ³gica basada en reglas para comportamiento confiable</li>
                <li><strong>Capa de ValidaciÃ³n:</strong> Q-Learning para refinamiento de comportamiento</li>
                <li><strong>Capa de Seguridad:</strong> Mecanismos anti-atasco y de respaldo</li>
            </ol>

            <div class="code-block">
                <pre>def barrel_movement(self, platforms, player_rect=None):
    # 1. DecisiÃ³n primaria basada en reglas
    primary_action = self.decide_primary_action(dx, dy, current_platform, player_platform)
    
    # 2. ValidaciÃ³n Q-Learning
    if hasattr(self, 'ai_agent'):
        q_action = self.ai_agent.choose_action(state)
        if self.should_override_action(primary_action, q_action, dx, dy):
            primary_action = q_action
    
    # 3. Ejecutar decisiÃ³n
    self.execute_action_decision(primary_action, current_platform, dx)</pre>
            </div>

            <h2>GestiÃ³n de Datos</h2>

            <h3>IntegraciÃ³n con Firebase (src/managers/firebase_manager.py)</h3>
            <p><span class="highlight">Servicios Utilizados:</span></p>
            <ul>
                <li><strong>Realtime Database:</strong> Leaderboards y guardados en la nube</li>
                <li><strong>Authentication:</strong> GestiÃ³n de usuarios</li>
                <li><strong>REST API:</strong> ComunicaciÃ³n HTTP directa (sin SDK)</li>
            </ul>

            <div class="code-block">
                <pre>{
  "leaderboard": {
    "user_id": {
      "email": "player@example.com",
      "best_score": 1500,
      "timestamp": 1640995200
    }
  },
  "cloud_saves": {
    "user_id": {
      "save_data": {
        "level": 3,
        "score": 1200,
        "lives": 2
      },
      "last_updated": 1640995200
    }
  }
}</pre>
            </div>

            <h3>GestiÃ³n de Datos Locales</h3>
            <p><span class="highlight">Sistema de Guardado</span> (src/managers/save_manager.py):</p>
            <ul>
                <li>Guardados locales basados en JSON</li>
                <li>Persistencia del progreso del jugador</li>
                <li>SerializaciÃ³n del estado del juego</li>
            </ul>

            <h2>Sistema de UI</h2>

            <h3>Sistema de MenÃºs (src/ui/)</h3>
            <p><span class="highlight">Componentes:</span></p>
            <ul>
                <li>MenÃº Principal</li>
                <li>MenÃº de Tienda (con imÃ¡genes de objetos)</li>
                <li>MenÃº de Pausa</li>
                <li>Pantalla de Game Over</li>
                <li>VisualizaciÃ³n de Leaderboard</li>
            </ul>

            <div class="code-block">
                <pre>class ShopMenu:
    def load_item_images(self):
        """Carga iconos de objetos desde assets/shop/"""
        
    def render(self, screen, player, shop_manager):
        """Renderiza tienda con imÃ¡genes y estadÃ­sticas del jugador"""</pre>
            </div>

            <h2>GestiÃ³n de Assets</h2>

            <h3>Sistema de Sprites</h3>
            <p><span class="highlight">Sprites del Jugador:</span></p>
            <ul>
                <li><code>sprite_00.png</code> - Estado inactivo</li>
                <li><code>sprite_01.png</code> a <code>sprite_11.png</code> - Secuencia de salto</li>
            </ul>

            <p><span class="highlight">Sprites de Enemigos:</span></p>
            <ul>
                <li><code>enemy1.png</code>, <code>enemy2.png</code>, <code>enemy3.png</code> - Frames de animaciÃ³n</li>
                <li>Escalado automÃ¡tico al tamaÃ±o de entidad</li>
                <li>Volteo de sprite basado en direcciÃ³n</li>
            </ul>

            <h2>OptimizaciÃ³n de Rendimiento</h2>

            <h3>GestiÃ³n de Entidades</h3>
            <p><span class="highlight">Estrategias de OptimizaciÃ³n:</span></p>
            <ul>
                <li>Limpieza de entidades inactivas</li>
                <li>LimitaciÃ³n de tasa de spawn</li>
                <li>OptimizaciÃ³n de colisiones (conceptos de particionado espacial)</li>
            </ul>

            <div class="code-block">
                <pre># Limpieza eficiente de entidades
for entity in self.entities[:]:  # IteraciÃ³n segura
    entity.update()
    if not entity.active:
        self.entities.remove(entity)</pre>
            </div>

            <h2>Manejo de Errores</h2>

            <h3>Sistemas Robustos</h3>
            <p><span class="highlight">Respaldos de Firebase:</span></p>
            
            <div class="code-block">
                <pre>def get_global_leaderboard(self, limit=10):
    try:
        # OperaciÃ³n Firebase
        return data
    except Exception as e:
        print(f"Error: {e}")
        return []  # Respaldo elegante</pre>
            </div>

            <h2>GestiÃ³n de ConfiguraciÃ³n</h2>

            <h3>Variables de Entorno</h3>
            <p><span class="highlight">Seguridad:</span></p>
            <ul>
                <li>Datos sensibles en <code>.env</code></li>
                <li>ProtecciÃ³n con <code>.gitignore</code></li>
                <li>ConfiguraciÃ³n de ejemplo (<code>.env.example</code>)</li>
            </ul>

            <div class="code-block">
                <pre>class Config:
    WINDOW_WIDTH = 800
    WINDOW_HEIGHT = 600
    FPS = 60
    
    COLORS = {
        'BLACK': (0, 0, 0),
        'WHITE': (255, 255, 255),
        # ... mÃ¡s colores
    }</pre>
            </div>

            <h2>Arquitectura de Despliegue</h2>

            <h3>Sistema de Build (build.py)</h3>
            <p><span class="highlight">ConfiguraciÃ³n de PyInstaller:</span></p>
            <ul>
                <li>Empaquetado de assets</li>
                <li>ResoluciÃ³n de dependencias</li>
                <li>Compatibilidad multiplataforma</li>
            </ul>

            <h2>ConclusiÃ³n</h2>
            <p>Esta arquitectura proporciona una base sÃ³lida para un juego mantenible, extensible y de alto rendimiento, manteniendo una separaciÃ³n limpia de responsabilidades y un manejo robusto de errores. El patrÃ³n de managers permite una fÃ¡cil extensiÃ³n y modificaciÃ³n de funcionalidades sin afectar otros sistemas.</p>
        </div>
    </div>
</body>
</html>